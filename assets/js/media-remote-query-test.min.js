window.ocs=window.ocs||{},ocs.rml=ocs.rml||{},function(a){"use strict";ocs.rml.AccountStatusManager=function(){this.init()},ocs.rml.AccountStatusManager.prototype={$statusField:a(".rml-status-field"),$querymsg:a("#query_msg"),$loading:a("#rmlloading"),$currentFields:null,authInterval:null,init:function(){},hookevents:function(){var b=this;a("#rml_service_selection,#rml_account_settings select").live("change",function(){b.setStatus("unknown")}),a("#rml_account_settings input").live("keyup",function(){b.setStatus("unknown")}),a(".action_query_test").live("click",function(){b.validate()})},fetchActiveFields:function(){this.$currentFields=a(".rmlfields-"+a("#remote_media_type").val())},getServiceClass:function(){return this.fetchActiveFields(),this.$currentFields.find("#service_class").val()||""},getPostId:function(){return a("#post_ID").val()},setStatus:function(b){var c=a("#rmlaccountstatus");c.html(b),this.$querymsg.html(""),b===rmlQueryTestParams.status.invalid&&this.$querymsg.html('<div class="dashicons dashicons-no ocs-3x ocs-red" style="margin-top: -3px; padding: 0 10px;"></div>'),b===rmlQueryTestParams.status.enabled&&this.$querymsg.html('<div class="dashicons dashicons-yes ocs-3x ocs-green" style="margin-top: -3px; padding: 0 10px;"></div>')},getCurrentSettings:function(){var b={},c=a(".rmlfields-"+a("#remote_media_type").val()).find("input");return a.each(c,function(){var c=this.name.indexOf("[",this.name.indexOf("[")+1)+1,d=this.name.indexOf("]",this.name.indexOf("]")+1),e=this.name;e=e.substr(c,d-c),b[e]=a(this).val()}),b},authenticate:function(a){var b,c=this;this.$loading.css("display","inline-block"),this.setStatus(rmlQueryTestParams.status.authProcessing),a&&(b=window.open(a,"rmlauthprocess","height=400,width=800"),this.authInterval=window.setInterval(function(){try{(null===b||b.closed)&&c.authdone(0)}catch(a){}},1e3))},authdone:function(b){var b=parseInt(b)||0;window.clearInterval(this.authInterval),this.$loading.hide(),1===b?(this.setStatus(rmlQueryTestParams.status.enabled),a(".rmlnotice").hide(),a("#rmlstatusbutton").html(rmlQueryTestParams.button.reauth)):this.setStatus(rmlQueryTestParams.status.authfailed),this.$loading.hide()},validate:function(){var b=this,c={action:"rmlQueryTest",security:rmlQueryTestParams.nonce,post_id:this.getPostId(),account:this.getCurrentSettings()};return b.$loading.css("display","inline-block"),a.post(rmlQueryTestParams.ajax_url,c,function(d){return b.$loading.hide(),c=a.parseJSON(d),c.authneeded&&c.authurl?(b.authenticate(c.authurl),!0):c.authneeded||1!==parseInt(c.validate)?(b.setStatus(rmlQueryTestParams.status.invalid),!1):(b.setStatus(rmlQueryTestParams.status.enabled),!0)}),!1}},ocs.rml.statusManager=new ocs.rml.AccountStatusManager,a(document).ready(function(){ocs.rml.statusManager.hookevents()})}(jQuery);